# 데이터 경로의 이해

## 데이터 경로

**명령어를 실행할 때 프로세서가 명령어의 정의에 따라 데이터를 경유시키는 경로**를 데이터 경로라고 한다. 데이터는 입력장치, 프로세서, 메모리, 출력장치 등 컴퓨터의 모든 구성 요소를 경유한다. 입출력 명령이 아니라면 명렁어에 대한 데이터 경로는 프로그램 계수기, 레지스터 파일, 연산장치, 메모리 등으로 구성된다.

## 데이터 경로의 두 가지 방식

데이터 경로는 단일 사이클 방식과 다중 사이클 방식으로 구현할 수 있다.

> ex) 두 종류의 16비트덧셈장치를 이용하여 16비트로 구성된 두 수를 덧셈하는 경우
>
> 단일 사이클 덧셈장치 : 한 사이클 동안에 16개의 전가산기를 사용해 16비트를 모두 더함
>
> 다중 사이클 덧셈장치 : 하나의 전가산기를 16번 반복 사용하여 1비트씩 연산한 결과를 차례대로 저장

그리고 위의 예시를 계속하여, 각 장치의 지연시간은 다음과 같다.

- 단일 사이클 방식 : (명령어 1개) x (1사이클 / 명령어)  x (16ns / 사이클)
- 다중 사이클 방식 : (명령어 1개) x (16사이클 / 명령어) x (1ns / 사이클)



# 명령어 실행과 데이터 경로

## picoMIPS의 명령어 형식

picoMIPS는 다음과 같이 R-형식, I-형식, J-형식의 명령어 형식을 지원하고, 명령어 형식은 연산 부호에 의해 결정된다.

- R-형식 : 레지스터 2개를 사용하여 연산장치에서 처리한 후 연산 결과를 다른 레지스터에 저장하는 명령어
- I-형식 : 메모리 참조, 상수 피연산자를 가진 연산, 조건 분기 등을 수행하는 명령어
- J-형식 : 무조건 분기를 수행하는 명령어

모든 명령어는 16비트로 구성되어 있지만 필드의 개수는 각각 다르다.

## picoMIPS 명령어의 단계적 실행

- 명령어 인출 : 모든 명령어는 명령어 형식과 상관 없이 다음과 같은 작업을 통해 실행할 명령어를 인출한다.

  - PC가 가리키는 메모리의 내용인 명령어를 읽는다.
  - PC가 다음 명령어를 가리키도록 PC의 내용을 갱신한다.

  

- 명령어 해독 및 레지스터 읽기 : 실행할 명령어를 인출하면 제어장치가 명령어의 연산 부호를 해독할 수 있다. 이렇게 연산부호를 해독하는 동안 명령어를 구성 요소별로 분해하여 다음과 같은 작업을 수행할 수 있다.

  - R-형식 명령어 : 3개의 레지스터 주소를 추출하고, 그 중 2개의 레지스터 주소(rs, rt)를 이용하여 레지스터의 내용을 읽는다.
  - I-형식 명령어 : 2개의 레지스터 주소를 추출하고, 그 중 1개의 레지스터 주소 (rs) 또는 2개의 레지스터 주소 (rs, rt)를 이용하여 레지스터의 내용을 읽는다.
  - J-형식 명령어 : 레지스터의 내용을 읽을 필요가 없다.

  

- 명령어 종류별 고유 과정 : 명령어 인출과 레지스터 읽기 과정이 끝나면 이미 제어장치가 명령어의 연산 부호를 해독한 상태이다. 그러므로 연산을 수행할 수 있다.

  - 산술연산 및 논리연산 : ALU를 이용하여 연산을 수행한 후 결과를 레지스터에 저장한다.
  - 메모리 참조 : ALU를 이용하여 메모리 주소를 계산한다. 메모리와 레지스터 사이에 데이터를 이동한다.
  - 조건 분기 : 조건의 만족 여부에 따라 분기 주소로 PC를 갱신한다.
  - 무조건 분기 : PC를 조건 없이 분기 주소로 갱신한다.

## 데이터 경로의 기본 골격

- 단일 사이클 방식
  - 명령어가 동일한 사이클 동안 메모리에 두 번 이상 접근할 수도 없고 ALU도 두 번 이상 사용할 수 없기 때문에 명령어 인출, 데이터 읽기 쓰기를 하기위해 메모리는 2개로 분할한다.
  - PC 값을 갱신할 때 ALU를 사용하지 않고 별도의 PC 갱신 장치를 사용해야한다.
- 다중 사이클 방식
  - 메모리를 분할할 필요가 없고, 별도의 PC 갱신장치도 필요 없다.



# 단일 사이클 방식의 명령어 실행

> 2.2의 예시이므로 생략



# 다중 사이클 방식의 명령어 실행

## 명령어 인출

## 명령어 해독과 레지스터 읽기

## 덧셈 명령어 실행

## 적재 명령어 실행



# 데이터 경로의 구체화와 성능 비교

## 데이터 경로의 구체화

## 단일 사이클 방식과 다중 사이클 방식의 성능 비교

