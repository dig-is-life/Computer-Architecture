# 제어장치

## 제어장치의 이해
명령어의 지시에 따라 데이터를 처리하고 저장하려면 주어진 데이터 경로를 데이터가 적정하게 경유하도록 제어하는 제어장치가 필요함.

### 제어장치
제어장치 : 데이터 경로와 함께 CPU 의 주요 구성 요소로서 명령어 장치 라고도 함
  - 메모리에서 명령어 가져와 해독 후 시스템 전체에 제어 신호를 보냄
    - 해당 명령어 지시대로 ALU, 레지스터 파일, 메모리, IO장치가 동작
  - 프로세서의 상태와 클록 펄스를 입력으로 받아 들임
    - 프로세서 상태에 따라 보낼 제어 신호가 다를 수 있기 때문

즉, 제어장치가 하는 일을 정리하면 다음과 같다.

- 명령어 해독 : 명령의 연산 부호를 해독
- 제어 신호 생성 : 명령어의 연산 부호를 해독한 결과와 기능 필드, 상태 레지스터, 외부 신호 등과 같은 정보를 사용해 명령어 실행에 필요한 제어 신호를 생성
- 제어 신호 인가 : 데이터 경로를 구성하는 각종 장치에 생성된 제어 신호 인가해 작업 수행하도록 함

이런 제어장치를 구현하는 방식으로 크게 2가지가 있다고 한다.

1. 고정결선식 제어 방식
2. 마이크로프로그래밍 제어 방식

### 마이크로 연산과 제어 신호
마이크로 연산 : 프로세서 상태를 변경하는 동작의 기본 단위
  - 명령어를 실행하려면 프로세서가 의미 있는 상태 변환을 수행할 수 있도록 다양한 연산이 필요함

제어 신호 : 다양한 제어점에 인가되어 데이터의 흐름을 제어하거나 연산의 종류를 선택
  - 마이크로 연산을 수행하기 위해 필요함

> 자세한 그림은 271쪽 참고

### PROM 과 PLA
PLD : 제어 장치에서 제어 신호를 생성하기 위한 복잡한 논리회로를 실현하는데 필요
  - PLD 로 PROM(Programmable Read Only Memory), PLA(Programmable Login Array) 가 있음

> 자세한 그림 273쪽 참고

PROM : ROM 회로의 변종으로 프로그래밍 가능
  - 자주 사용되는 데이털르 영구/반영구적으로 보관하기 위한 메모리
  - 첫 번째 단계에서 디코더 통해 모든 최소항 생성, 두 번째로 OR 게이트를 사용하여 원하는 출력을 최소항의 합으로 구성

> 자세한 그림 273~274쪽 참고

PLA : 첫 번째 단계에서 AND 게이트를 사용해 필요한 모든 곱의 항을 생성. 두 번째 단계에서 OR 게이트를 사용해 전 단계에서 생성한 곱의 항에 대한 합으로 원하는 출력 구성


> 최소항 : https://www.google.com/search?q=%EC%B5%9C%EC%86%8C%ED%95%AD%EC%9D%B4%EB%9E%80&oq=%EC%B5%9C%EC%86%8C%ED%95%AD%EC%9D%B4%EB%9E%80&aqs=chrome..69i57.1504j0j7&sourceid=chrome&ie=UTF-8
> 읽어도 헷갈림

## 제어장치 구현 방식

### 제어 신호의 생성
|연산부호|00|01|10|11|
|---|--|--|--|--|
|제어신호|0|0|0|1|

표와 같은 연산 부호를 해독해 제어 신호를 생성하려면 조합 논리회로나 PROM 을 사용할 수 있다.

> 자세한 그림 275 쪽 참고

AND 게이트 대신에 1 X 4 PROM 을 사용할 수 있는데 `0 0 0 1` 데이터를 저장하고 연산 부호를 PROM 의 주소로 사용하면 AND 게이트와 동일한 제어 신호 생성한다.

출력될 제어 신호 바뀌는 경우 조합 논리 회로를 사용한 경우 다시 설계해야 하지만 PROM 을 사용한 경우 해당 저장된 데이터만 다시 프로그래밍 하면 되기 때문에 융통성 높다

### 제어장치 구현의 두 가지 방식
불규칙, 전역적인 제어회로는 고정결선식 제어 방식과, 마이크로프로그래밍 제어 방식으로 구현할 수 있다.

- 고정결선식 제어장치 : 조합 논리화로를 사용해 구현
- 마이크로프로그래밍 제어장치 : PROM 사용해 필요한 제어 신호 프로그래밍해 구현

> 자세한 그림 276 쪽 참고

#### 고정결선식 제어장치
고정결선식 제어장치를 구성할 경우, 명령어 구성이 복잡하거나 명령어의 수가 많아지면 제어장치를 위한 조합 논리회로를 설계, 검증하기 매우 복잡 및 어려워진다. (오늘 날의 컴퓨터는 PLA 사용해 효과적으로 구현한다 함)

- 장점
  - 최적화 할 수 있어 제어 신호를 빠른 시간에 생성 가능
  - ROM 과 달리 불필요한 회로를 제거할 수 있어 칩의 크기가 작음

최근 RISC 아키텍처의 출현으로 CAD 기술의 발전으로 오늘 날의 많은 컴퓨터는 고정결선식 방식을 도입하고 있다고도 한다.

#### 마이크로프로그래밍 제어 방식
마이크로프로그래밍은 마이크로 연산을 수행할 수 있도록 마이크로 명령어를 PROM 에 프로그래밍하는 방식

마이크로프로그래밍 방식은 ROM 에 저장된 마이크로 명령어를 사용하여 제어신호를 생성하고 제어점에 인가하는데 ROM 을 사용하면 불필요한 회로가 포함 돼 칩의 면적 커지고, ROM 메모리에 의해 속도가 제한된다.

- 장점
  - 모든 명령어에 대해 마이크로 연산 도출 후 프로그래밍하기 때문에 설계 및 검증 용이
  - 연산 부호, 프로세서 상태 추가될 경우 PROM 에 다시 프로그래밍하면 됨
  - 다른 종류의 명령어 집합을 에뮬레이션 할 수 있음
  - 동일한 시스템에 다수의 명령어 집합을 구현 가능

그러나 최근엔 제어장치가 프로세서의 나머지 부분과 하나의 칩으로 집적될 수 있고 시뮬레이션 기술도 발달해 나중에 제어장치를 수정할 일이 거의없어 점차 퇴색되고 있다고 함

## 마이크로프로그래밍 방식의 제어장치

### 마이크로 명령어의 구성 요소
마이크로 명령어는 명령어를 수행하기 위해 PROM 에 저장하며 순차적으로 실행할 수 있음. 저장하기 위한 PROM 을 제어 저장소, 제어 메모리라고 부른다

하나의 명령어가 실행되는데 하나 이상의 마이크로 명령어가 실행될 수 있고, 비순차적일 수 있어 다음의 3가지 필드가 필요하다.

- 마이크로 연산 필드 : 모든 제어점에 대응하는 마이크로 연산으로 구성
- 분기 조건 필드 : 명령어의 실행 순서가 비순차적일 수도 있어 분기할 조건을 마이크로 명령어에 포함해야 함
- 다음 마이크로 명령어 주소 필드 : 분기될 경우 실행해야 할 다음 마이크로 명령어의 주소를 포함하는 필드

### 마이크로 명령어의 제어
- 제어 저장소 
  - 마이크로 명령어를 그룹 단위로 구성, 기능에 따라 그룹 결정
  - 마이크로 명령어의 그룹을 제어 루틴이라 함

- 제어루틴
  - 특정기능을 위해 수행되어야 할 마이크로 명령어의 집합을 의미
  - 모든 제어 루틴의 마지막은 다음에 수행될 제어 루틴으로 분기하는 마이크로 명령어를 포함한다

> 자세한 그림 280쪽 참고

제어장치는 명령어가 의도하는 마이크로 명령어를 포함하는 제어 루틴에 순차적으로 접근함으로 써 명령어에 대한 제어 신호를 생선한다.

이 때 제어 저장소에 있는 마이크로 명령어를 순차적으로 읽기 위해 마이크로프로그램 계수기를 사용한다.

하나의 명령어가 종료되면 새로운 명령어를 인출하기 위해 계수기가 제어 저장소에서 명령어 인출 루틴의 시작 주소를 가리킨다.

---

제어장치는 순서 제어 모듈을 사용해 제어 저장소에 있는 마이크로프로그램의 시작 주소를 생성해 계수기로 보내고 명령어를 실행할 때마다 계수기를 하나씩 증가시켜 순차적으로 명령어를 수행시킨다.

> 자세한 내용 281 쪽 참고

### 마이크로 명령어의 형식
마이크로 명령어는 데이터 경로에 적용할 제어 신호의 코딩 방법에 따라 수평적 마이크로 명령어, 수직적 마이크로 명령어로 분류됨

#### 수평적 마이크로 명령어
- 수평적 마이크로 명령어
  - 마이크로 연산 필드의 모든 비트를 제어 신호와 일대일로 대응시키는 방식
  - 직관적이지만 마이크로 명령어가 모든 제어점에 인가할 제어 신호 자체를 포함해 명령어 길이가 매우 길어짐
  - 하드웨어가 간단해지고 명령어 해독에 따른 지연시간이 없어 속도가 빠름

### 수직적 마이크로 명령어
- 수직적 마이크로 명령어
  - 마이크로 연산 필드를 인코더로 압축해 마이크로 명령어의 길이를 줄인 방식
  - 디코더 사용해 마이크로 연산 필드의 내용을 해독해야 제어 신호가 됨
  - 디코더를 사용해야 하므로 속도가 느림






